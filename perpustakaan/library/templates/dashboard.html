<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ================= TAILWIND ================= -->
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        base: '#f8fafc',
        panel: '#ffffff',
        soft: '#f1f5f9',
        borderSoft: '#e5e7eb',
        textMain: '#0f172a',
        textSoft: '#475569',
        accent: '#0ea5e9',
        accentSoft: '#38bdf8'
      },
      fontFamily: {
        poppins: ['Poppins', 'sans-serif']
      }
    }
  }
}
</script>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
@keyframes scaleIn {
  from {opacity:0;transform:scale(.96)}
  to {opacity:1;transform:scale(1)}
}
</style>
</head>

<body class="font-poppins bg-base text-textMain min-h-screen">

<!-- ================= WELCOME LOADER ================= -->
<div id="welcomeLoader"
     class="fixed inset-0 z-[9999] flex flex-col items-center justify-center bg-base">
  <div class="w-14 h-14 rounded-full border-4 border-accent/30 border-t-accent animate-spin mb-6"></div>
  <h2 class="text-xl font-semibold">Selamat Datang</h2>
  <p class="text-sm text-textSoft mt-2 tracking-widest uppercase">
    Sistem Inventaris Skensa
  </p>
</div>

<!-- ================= REDIRECT LOADER ================= -->
<div id="redirectLoader"
     class="fixed inset-0 z-[9999] hidden items-center justify-center bg-black/30 backdrop-blur-sm">
  <div class="bg-panel rounded-2xl px-8 py-6 shadow-xl text-center">
    <div class="w-8 h-8 mx-auto rounded-full border-4 border-accent/30 border-t-accent animate-spin mb-4"></div>
    <p class="text-sm text-textSoft">Mengalihkan halaman,Jika Stuck Harap Refresh</p>
  </div>
</div>

<div class="px-6 py-8">

<!-- ================= WELCOME MESSAGE ================= -->
<section class="mb-10">
  <div class="bg-panel border border-borderSoft rounded-2xl p-6
              flex flex-col md:flex-row items-start md:items-center
              justify-between gap-4 shadow-sm">
    <div>
      <h2 class="text-xl font-semibold">üëã Selamat Datang!</h2>
      <p class="text-sm text-textSoft mt-1">
        Kelola dan lakukan peminjaman barang dengan mudah melalui
        <span class="font-medium text-textMain">Sistem Inventaris Skensa</span>.
      </p>
    </div>
    <div class="flex gap-3">
      <span class="px-4 py-2 rounded-xl text-xs font-semibold bg-accent/10 text-accent">Jadikan Lebih Mudah</span>
      <span class="px-4 py-2 rounded-xl text-xs font-semibold bg-emerald-100 text-emerald-600">Sistem Peminjaman</span>
    </div>
  </div>
</section>

<!-- ================= HEADER ================= -->
<header class="relative z-50 mb-10
               bg-panel/80 backdrop-blur
               border border-borderSoft
               rounded-2xl px-6 py-5
               flex flex-col lg:flex-row gap-6
               lg:items-center lg:justify-between">

  <div>
    <h1 class="text-2xl font-semibold tracking-tight">Peminjaman Barang</h1>
    <p class="text-sm text-textSoft mt-1">Sistem Inventaris Skensa</p>
  </div>
  

  <!-- Search -->
  <div class="w-full lg:w-80 relative">
    <input id="searchInput" type="text" placeholder="Cari barang‚Ä¶"
      class="w-full bg-soft border border-borderSoft rounded-xl px-4 py-3 text-sm
             focus:outline-none focus:ring-2 focus:ring-accent/30">
    <span class="absolute right-4 top-1/2 -translate-y-1/2 text-textSoft">üîç</span>
  </div>

  <!-- Burger -->
  <div class="relative">
    <button id="burger"
      class="w-11 h-11 rounded-xl bg-soft border border-borderSoft
             flex flex-col items-center justify-center gap-1.5
             hover:bg-white transition">
      <span class="w-5 h-0.5 bg-textSoft rounded"></span>
      <span class="w-5 h-0.5 bg-textSoft rounded"></span>
      <span class="w-5 h-0.5 bg-textSoft rounded"></span>
    </button>

    <!-- Dropdown -->
    <div id="menuDropdown"
      class="absolute right-0 mt-3 w-56 rounded-xl
             bg-panel border border-borderSoft shadow-xl
             z-[999]
             opacity-0 scale-95 pointer-events-none
             transition-all duration-200">

      <a href="{% url 'library:daftar_barang' %}" onclick="redirect(event,this.href)"
         class="block px-5 py-3 text-sm hover:bg-soft">Daftar Barang</a>

      <a href="{% url 'library:pengembalian_buku' %}" onclick="redirect(event,this.href)"
         class="block px-5 py-3 text-sm hover:bg-soft">Pengembalian</a>

      <a href="{% url 'library:status_peminjaman' %}" onclick="redirect(event,this.href)"
         class="block px-5 py-3 text-sm hover:bg-soft">Status Peminjaman</a>

      <div class="border-t border-borderSoft"></div>

      <a href="{% url 'library:login' %}" onclick="redirect(event,this.href)"
         class="block px-5 py-3 text-sm text-red-500 hover:bg-red-50">Logout</a>
    </div>
  </div>
</header>

<!-- ================= GRID ================= -->
<section id="barangGrid"
  class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">

{% for buku in barang_list %}
<div data-name="{{ buku.nama_barang|lower }}"
  class="barang-card bg-panel rounded-2xl border border-borderSoft
         shadow-sm hover:shadow-lg hover:-translate-y-1
         transition-all duration-300 overflow-hidden">

  {% if buku.gambar %}
  <img src="{{ buku.gambar.url }}" class="h-52 w-full object-cover">
  {% else %}
  <img src="https://images.unsplash.com/photo-1524995997946-a1c2e315a42f"
       class="h-52 w-full object-cover">
  {% endif %}

  <div class="p-5 text-center">
    <h3 class="text-sm font-semibold">{{ buku.nama_barang }}</h3>
    <p class="text-xs text-textSoft mt-1">{{ buku.kategori.nama }}</p>

    <span class="inline-block mt-3 px-4 py-1.5 rounded-full text-xs font-semibold
      {% if buku.stok == 0 %}bg-red-100 text-red-600{% else %}bg-emerald-100 text-emerald-600{% endif %}">
      {% if buku.stok == 0 %}Stok Habis{% else %}Stok: {{ buku.stok }}{% endif %}
    </span>

    <div class="flex justify-center gap-3 mt-5">
      <button onclick="openModal('{{ buku.id }}','{{ buku.nama_barang }}')"
        class="px-4 py-2 rounded-lg bg-accent hover:bg-accentSoft
               text-white text-xs font-semibold">Pinjam</button>

      <a href="{% url 'library:ulasan' buku.id %}"
        class="px-4 py-2 rounded-lg bg-soft text-xs font-semibold">Ulasan</a>
    </div>
  </div>
</div>
{% endfor %}
</section>

<!-- EMPTY -->
<div id="emptyState"
  class="hidden flex flex-col items-center justify-center mt-20 text-center">
  <div class="text-6xl mb-4">üì¶</div>
  <h3 class="text-lg font-semibold">Barang tidak ditemukan</h3>
  <p class="text-sm text-textSoft mt-2">Coba kata kunci lain</p>
</div>

</div>

<!-- ================= MODAL ================= -->
<div id="modal"
  class="fixed inset-0 bg-black/30 backdrop-blur-sm hidden items-center justify-center z-[9999]">
  <div class="bg-panel rounded-2xl w-full max-w-md p-6 animate-[scaleIn_0.25s_ease-out]">
    <h3 class="text-lg font-semibold mb-2" id="modalTitle"></h3>
    <p class="text-sm text-textSoft mb-6">Yakin ingin meminjam barang ini?</p>
    <div class="flex justify-end gap-3">
      <button onclick="closeModal()" class="px-4 py-2 rounded-lg bg-soft text-sm">Batal</button>
      <a id="confirmPinjam"
         class="px-4 py-2 rounded-lg bg-accent text-sm font-semibold text-white">Pinjam</a>
    </div>
  </div>
</div>

<!-- ================= JS (ASLI, TIDAK DIUBAH) ================= -->
<script>
window.addEventListener('load',()=>{
  const l=document.getElementById('welcomeLoader');
  setTimeout(()=>{l.classList.add('opacity-0');setTimeout(()=>l.remove(),700)},1200);
});

const burger=document.getElementById('burger');
const menu=document.getElementById('menuDropdown');
burger.onclick=()=>{
  menu.classList.toggle('opacity-0');
  menu.classList.toggle('pointer-events-none');
  menu.classList.toggle('scale-95');
}

function redirect(e,url){
  e.preventDefault();
  const l=document.getElementById('redirectLoader');
  l.classList.remove('hidden');l.classList.add('flex');
  setTimeout(()=>window.location.href=url,800);
}

const searchInput=document.getElementById('searchInput');
const cards=document.querySelectorAll('.barang-card');
const empty=document.getElementById('emptyState');
let t;
searchInput.addEventListener('input',()=>{
  clearTimeout(t);
  t=setTimeout(()=>{
    let v=searchInput.value.toLowerCase(),c=0;
    cards.forEach(card=>{
      card.dataset.name.includes(v)?(card.classList.remove('hidden'),c++):card.classList.add('hidden');
    });
    empty.classList.toggle('hidden',c!==0);
  },300);
});

function openModal(id,name){
  modal.classList.remove('hidden');modal.classList.add('flex');
  modalTitle.innerText=name;
  confirmPinjam.href=`/pinjam/${id}/`;
}
function closeModal(){
  modal.classList.add('hidden');modal.classList.remove('flex');
}
</script>

</body>
</html>
